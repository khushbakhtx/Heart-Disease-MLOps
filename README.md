# **MLOps. Heart Disease Classification**

[**Ссылка на датасет**](https://www.kaggle.com/datasets/fedesoriano/heart-failure-prediction)

---
## **Описание**

Данный проект предназначен для определения будет/есть ли у пациента заболевание сердца или нет зная определенную информацию о нем или о ней. Разумеется подобное прогнозирование осуществляется автоматизированным путем, тоесть если наш пациент проходит диагностику и мы уже имеем некоторую информацию из его карточки (у каждого индивидуума она есть в поликлинике или в больнице). Так благодаря дополнительным обследованиям которые будут нашими характеристиками(features) наша модель или система из нескольких моделей будет давать прогноз по его/ее состоянию.

---
### Характеристики и их описание



1. **Age (Возраст пациента)**  
   - **Значение**: Возраст пациента в годах. (0-105)
   - **как получить**: Обычно собирается в медицинской документации пациента при первичном осмотре.
   - **Зачем нужно**: Возраст является важным фактором, влияющим на риск возникновения сердечно-сосудистых заболеваний. Чем старше человек, тем выше вероятность заболеваний сердца.

2. **Sex (Пол пациента)**  
   - **Значение**: Пол пациента (М — мужчина, F — женщина).
   - **как получить**: Собирается при регистрации пациента в медицинской системе.
   - **Зачем нужно**: Пол также влияет на риск заболеваний сердца. Мужчины, как правило, имеют более высокий риск сердечно-сосудистых заболеваний в более раннем возрасте, чем женщины.

3. **ChestPainType (Тип боли в груди)**  
   - **Значение**: Тип боли в груди:
     - **TA**: Типичная стенокардия (постоянная боль, обычно возникающая при нагрузке)
     - **ATA**: Атипичная стенокардия (боль не является классической для стенокардии)
     - **NAP**: Безболезненная боль в груди (не связано с ишемией сердца)
     - **ASY**: Безсимптомное состояние (отсутствие болей)
   - **как получить**: Эта информация обычно собирается на основе жалоб пациента, полученных при медицинском осмотре.
   - **Зачем нужно**: Тип боли в груди может указать на наличие или отсутствие ишемической болезни сердца, что важно для диагностики.

4. **RestingBP (Покойное артериальное давление)**  
   - **Значение**: Систолическое давление (верхнее) в покое, измеряется в миллиметрах ртутного столба (мм рт. ст.).  ('Normal' 'ST' 'LVH')
   - **как получить**: Измеряется врачом во время обычного медицинского осмотра.
   - **Зачем нужно**: Высокое артериальное давление является важным фактором риска сердечно-сосудистых заболеваний, в том числе инфаркта и инсульта.

5. **Cholesterol (Холестерин в сыворотке крови)**  
   - **Значение**: Уровень общего холестерина в крови пациента, измеряется в миллиграммах на децилитр (мг/дл).
   (**integer**)
   - **как получить**: Обычно измеряется в лабораторных условиях с помощью анализа крови.
   - **Зачем нужно**: Высокий уровень холестерина может привести к образованию бляшек в сосудах, что увеличивает риск сердечных заболеваний.

6. **FastingBS (Уровень сахара в крови натощак)**  
   - **Значение**: Если уровень сахара в крови натощак больше 120 мг/дл, то значение равно 1, иначе — 0.
   - **как получить**: Измеряется в лабораторных условиях после ночного голодания.
   - **Зачем нужно**: Высокий уровень сахара в крови может указывать на предрасположенность к диабету, что увеличивает риск сердечно-сосудистых заболеваний.

7. **RestingECG (Результаты покоящегося ЭКГ)**  
   - **Значение**: Результаты электрокардиограммы (ЭКГ) в покое:
     - **Normal**: Нормальный ЭКГ
     - **ST**: Наблюдаются аномалии ST-T (изменения волны Т или сегмента ST)
     - **LVH**: Признаки гипертрофии левого желудочка
   - **как получить**: Эта информация собирается с помощью ЭКГ, который выполняется в кабинете кардиолога.
   - **Зачем нужно**: ЭКГ помогает выявить различные заболевания сердца, такие как аритмии, ишемия и гипертрофия сердца.

8. **MaxHR (Максимальная частота сердечных сокращений)**  
   - **Значение**: Максимальная частота сердечных сокращений, которая была достигнута пациентом при физической нагрузке (измеряется в ударах в минуту). (**integer**)
   - **как получить**: С помощью кардиомониторов во время физической нагрузки или стресс-теста.
   - **Зачем нужно**: Максимальная частота сердечных сокращений может помочь оценить состояние сердечно-сосудистой системы и оценить риск заболеваний.

9. **ExerciseAngina (Ангина при физической нагрузке)**  
   - **Значение**: Наличие или отсутствие боли в груди во время физических упражнений:
     - **Y**: Боль в груди присутствует
     - **N**: Боль в груди отсутствует
   - **как получить**: Собирается на основе жалоб пациента, полученных во время физической активности или стресс-тестов.
   - **Зачем нужно**: Боль в груди при физической нагрузке может свидетельствовать о наличии стенокардии или других заболеваний сердца.

10. **Oldpeak (Oldpeak — депрессия сегмента ST)**  
    - **Значение**: Степень депрессии сегмента ST, измеренная в миллиметрах.
    - **как получить**: Получается в ходе стресс-теста или при анализе ЭКГ.
    - **Зачем нужно**: Депрессия сегмента ST может указывать на наличие ишемической болезни сердца.

11. **ST_Slope (Наклон сегмента ST на пике нагрузки)**  
    - **Значение**: Наклон сегмента ST на пике физической нагрузки:
      - **Up**: Наклон вверх
      - **Flat**: Плоский наклон
      - **Down**: Наклон вниз
    - **как получить**: Измеряется в ходе стресс-теста или при анализе ЭКГ.
    - **Зачем нужно**: Наклон сегмента ST помогает врачам определить наличие ишемической болезни сердца и другие патологии.

12. **HeartDisease (Заболевание сердца)**  
    - **Значение**: Это целевая переменная, которая указывает на наличие заболевания сердца:
      - **1**: Присутствует заболевание сердца
      - **0**: Нет заболевания сердца
    - **как получить**: Этот показатель обычно собирается на основе медицинских диагнозов, установленных после всех необходимых анализов и обследований.
    - **Зачем нужно**: Это итоговое значение, которое позволяет классифицировать пациента как больного или здорового на основе всех предыдущих характеристик.

---
## **Структура**
```
Heart-Disease/
│
├── app/                          # Основная директория приложения, содержащая код и артефакты модели.
│   ├── artefacts/                # Папка для хранения артефактов, например, промежуточных результатов или файлов, связанных с обучением модели.
│   ├── catboost_info/            # Папка для хранения информации о модели CatBoost (например, параметры или метаданные, связанные с CatBoost).
│   ├── data/                     # Директория, содержащая данные, используемые для обучения и тестирования модели.
│   │   ├── data_processed.csv    # Обработанный набор данных, готовый для подачи в модель.
│   │   └── data_wo_processing.csv # Непрерывные данные до предварительной обработки, возможно, изначальный набор данных.
│   ├── mlartifacts/              # Папка для хранения артефактов, связанных с машинным обучением, например, обученные модели, логи, графики и т.д.
│   ├── mlruns/                   # Каталог для хранения результатов запусков MLflow, таких как метрики, параметры и артефакты моделей.
│   ├── model/                    # Директория для хранения кода, связанного с обучением модели.
│   │   └── train.py              # Скрипт для обучения модели машинного обучения (например, модель CatBoost).
│   ├── preprocessing/            # Папка, содержащая код для предварительной обработки данных.
│   │   └── data_preprocessing.py # Скрипт для выполнения обработки данных перед подачей их в модель (например, очистка, нормализация).
│   ├── utils/                    # Утилиты, вспомогательные функции для проекта.
│   │   └── utils.py              # Скрипт с общими функциями, которые используются в других частях проекта.
│   ├── main.py                   # Основной скрипт для запуска приложения, инициирует процесс обучения, тестирования или деплоя.
│   └── deployment_flow.py        # Скрипт для развертывания модели, включая ее сохранение, регистрацию в MLflow и дальнейшую настройку для продакшн-среды.
│
├── notebook/                     # Папка для хранения Jupyter notebooks, где проводится анализ данных, обучение модели и эксперименты.
│
├── .gitignore                    # Файл для игнорирования не нужных файлов и директорий в Git (например, временные файлы, артефакты и т.д.).
│
└── README.md                     # Документация для проекта. Содержит описание проекта, инструкции по настройке, запуску и использованию.
```
---

## Описание экспериментов

1. **Эксперимент puzzled-sponge-17**:
   - **модель**: CatBoost
   - **теги**: `project: Heart Disease`, `version: v1.0`
   - **метрики**:
     - Точность: 88.7%
   - **артефакты**:
     - Модель: `model.pkl`
   - **описание&reflection**: Это был первый удачный эксперимент без всяких ошибок с использованием набора данных о сердечных заболеваниях и модель catboostclassifer для прогноза наличия заболевания.

2. **Эксперимент clean-hare-871**:
   - **модель**: CatBoost
   - **теги**: `project: Heart Disease`, `version: v2`
   - **метрики**:
     - Точность: 90.5%
   - **артефакты**:
     - Модель: `model.pkl`
     - Визуал: `feature_importance.png`, `roc_curve`
   - **описание&reflection**: На данном этапе применил оптимизацию гиперпараметров через оптуну, а зарегистрировал модель в конце как первую.

3. **Эксперимент resilient-snipe-1000**:
   - **модель**: CatBoost
   - **теги**: `version: v1.1`
   - **метрики**:
     - Точность: 90.5%
   - **артефакты**:
     - Модель: `model.pkl`, 
     - Визуал: `feature_importance.png`, `roc_curve`, `parallel_coordinate.png`, `optimization_history.png`
   - **описание&reflection**: зарегистрировал вторую модель `catboost_model_v1.1` .

   В процессе неудачных экспериментов было раз в 15 больше. Я включил сюда ключевые а другие оставил.

---

## Как запустить

1. Установить dependencies
    ```
    pip install -r requirements.txt
    ```
2. Запустить mlflow
    ```
    poetry run mlflow ui
    ```
3. Запустить main.py в app для эксперемента
    ```
    poetry run python main.py
    ```


